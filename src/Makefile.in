# $Header: /home/amb/wwwoffle/src/RCS/Makefile.in 1.18 2002/10/27 13:33:11 amb Exp $
#
# WWWOFFLE - World Wide Web Offline Explorer - Version 2.7g.
#
# Source Makefile.
#
# Written by Andrew M. Bishop
#
# This file Copyright 1996,97,98,99,2000,01,02 Andrew M. Bishop
# It may be distributed under the GNU Public License, version 2, or
# any higher version.  See section COPYING of the GNU Public license
# for conditions under which this file may be redistributed.
#

######## DEFINITIONS ########

# Make things

SHELL=/bin/sh

@SET_MAKE@

# The installation locations

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=$(DESTDIR)@bindir@
sbindir=$(DESTDIR)@sbindir@

# The installation program.

INSTALL=@INSTALL@

########

CC=@CC@
CFLAGS=@CFLAGS@ -Wall -Winline -D_GNU_SOURCE

LD=@CC@
LDFLAGS=@LDFLAGS@

LEX=@LEX@

ifeq ($(LEX),flex)
# Optimal flex options for a very fast but large HTML parser.
LEXFLAGS=-i -L -pp -B -F -8 -s

# Use this if you have flex but want a smaller but slower HTML parser.
#LEXFLAGS=-i -L -pp -B
else
# Fallback options if you have lex and not flex.
LEXFLAGS=-i -L
endif

PERL=@PERL@

########

INCLUDE=@ZLIB_INC@
LIBRARY=@LIBS@ @ZLIB_LIB@ @ETR_SOCKET_LIBS@

COMPILE=$(CC) -c $(CFLAGS)

LINK=$(LD) $(LDFLAGS)

######## COMPILATION ########

compile :: wwwoffled \
	   wwwoffle \
	   wwwoffle-tools \
	   convert-cache \
	   uncompress-cache

compile ::
	@cd testprogs && $(MAKE) compile

######## INSTALLATION ########

install : compile install-unix @install_win32@

install-unix :
	[ -x $(bindir) ] || $(INSTALL) -d -m 755 $(bindir)
	$(INSTALL) -s -m 755 wwwoffle $(bindir)
	$(INSTALL) -s -m 755 wwwoffle-tools $(bindir)
	ln -sf wwwoffle-tools $(bindir)/wwwoffle-ls
	ln -sf wwwoffle-tools $(bindir)/wwwoffle-mv
	ln -sf wwwoffle-tools $(bindir)/wwwoffle-rm
	ln -sf wwwoffle-tools $(bindir)/wwwoffle-read
	ln -sf wwwoffle-tools $(bindir)/wwwoffle-write
	ln -sf wwwoffle-tools $(bindir)/wwwoffle-hash
	[ -x $(sbindir) ] || $(INSTALL) -d -m 755 $(sbindir)
	$(INSTALL) -s -m 755 wwwoffled $(sbindir)

install-win32 :
	[ -x $(bindir) ] || $(INSTALL) -d -m 755 $(bindir)
	$(INSTALL) -c -m 755 wwwoffle.exe $(bindir)
	$(INSTALL) -c -m 755 wwwoffle-tools.exe $(bindir)
	$(INSTALL) -c -m 755 wwwoffle-tools.exe $(bindir)/wwwoffle-ls.exe
	$(INSTALL) -c -m 755 wwwoffle-tools.exe $(bindir)/wwwoffle-mv.exe
	$(INSTALL) -c -m 755 wwwoffle-tools.exe $(bindir)/wwwoffle-rm.exe
	$(INSTALL) -c -m 755 wwwoffle-tools.exe $(bindir)/wwwoffle-read.exe
	$(INSTALL) -c -m 755 wwwoffle-tools.exe $(bindir)/wwwoffle-write.exe
	$(INSTALL) -c -m 755 wwwoffle-tools.exe $(bindir)/wwwoffle-hash.exe
	$(INSTALL) -c -m 755 wwwoffled.exe $(bindir)
	-[ -f cygwin1.dll ] && $(INSTALL) -c -m 755 cygwin1.dll $(bindir)
	-[ -f cygz.dll ]    && $(INSTALL) -c -m 755 cygz.dll    $(bindir)
	@[ -f $(bindir)/cygwin1.dll -a -f $(bindir)/cygz.dll ] || \
	 (echo "WWWOFFLE: " ;\
	  echo "WWWOFFLE: You will need to copy the files cygwin1.dll and cygz.dll" ;\
	  echo "WWWOFFLE: into '$(bindir)' if you want to run WWWOFFLE" ;\
	  echo "WWWOFFLE: from windows and not just from the cygwin prompt." ;\
	  echo "WWWOFFLE: " )

######## CLEAN UP ########

clean ::
	-rm -f wwwoffle wwwoffled wwwoffle-tools convert-cache uncompress-cache
	-rm -f html.c htmlmodify.c messages.c xml.c vrml.c miscencdec.c
	-rm -f core *.o

clean ::
	@cd testprogs && $(MAKE) clean

########

distclean :: clean
	-rm -f autoconfig.h.in autoconfig.h
	-rm -f Makefile

distclean :: clean
	@cd testprogs && $(MAKE) distclean

######## PROGRAMS ########

WWWOFFLE_OBJ=wwwoffle.o \
	     http.o ftp.o finger.o ssl.o \
	     refresh.o \
             messages.o local.o cgi.o \
	     parse.o spool.o \
	     document.o html.o xml.o vrml.o javaclass.o \
	     configrdwr.o configmisc.o configdata.o configfunc.o \
	     errors.o io.o miscurl.o miscencdec.o headbody.o proto.o sockets.o md5.o

wwwoffle : $(WWWOFFLE_OBJ)
	$(LINK) $(WWWOFFLE_OBJ) -o $@ $(LIBRARY)

####

WWWOFFLED_OBJ=wwwoffled.o wwwoffles.o \
	      http.o ftp.o finger.o ssl.o \
	      document.o html.o xml.o vrml.o javaclass.o \
	      gifmodify.o htmlmodify.o \
	      connect.o control.o controledit.o search.o index.o info.o monitor.o \
              messages.o local.o cgi.o \
              parse.o purge.o refresh.o spool.o \
	      configrdwr.o configmisc.o configdata.o configfunc.o configedit.o \
	      errors.o io.o miscurl.o miscencdec.o headbody.o proto.o sockets.o md5.o

wwwoffled : $(WWWOFFLED_OBJ)
	$(LINK) $(WWWOFFLED_OBJ) -o $@ $(LIBRARY)

####

WWWOFFLE_TOOLS_OBJ=wwwoffle-tools.o \
	           http.o ftp.o finger.o ssl.o \
	           spool.o \
		   messages.o local.o cgi.o \
	           parse.o \
	           configrdwr.o configmisc.o configdata.o configfunc.o \
	           errors.o io.o miscurl.o miscencdec.o headbody.o proto.o sockets.o md5.o

wwwoffle-tools : $(WWWOFFLE_TOOLS_OBJ)
	$(LINK) $(WWWOFFLE_TOOLS_OBJ) -o $@ $(LIBRARY)

####

CONVERT_OBJ=convert-cache.o \
	    http.o ftp.o finger.o ssl.o \
	    messages.o local.o cgi.o \
	    parse.o \
	    configrdwr.o configmisc.o configdata.o configfunc.o \
	    errors.o io.o miscurl.o miscencdec.o headbody.o proto.o sockets.o spool.o md5.o

convert-cache : $(CONVERT_OBJ)
	$(LINK) $(CONVERT_OBJ) -o $@ $(LIBRARY)

####

UNCOMPRESS_OBJ=uncompress-cache.o \
	       http.o ftp.o finger.o ssl.o \
	       messages.o local.o cgi.o \
	       parse.o \
	       configrdwr.o configmisc.o configdata.o configfunc.o \
	       errors.o io.o miscurl.o miscencdec.o headbody.o proto.o sockets.o spool.o md5.o

uncompress-cache : $(UNCOMPRESS_OBJ)
	$(LINK) $(UNCOMPRESS_OBJ) -o $@ $(LIBRARY)

######## OBJECT FILES ########

.SUFFIXES:
.SUFFIXES: .c .o

.c.o:
	$(COMPILE) $< -o $@ $(INCLUDE)


wwwoffle.o         : wwwoffle.c         autoconfig.h wwwoffle.h misc.h            errors.h config.h sockets.h         document.h version.h
wwwoffled.o        : wwwoffled.c        autoconfig.h wwwoffle.h misc.h            errors.h config.h sockets.h                    version.h
wwwoffles.o        : wwwoffles.c        autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h sockets.h proto.h document.h

wwwoffle-tools.o   : wwwoffle-tools.c   autoconfig.h wwwoffle.h misc.h            errors.h config.h                              version.h

convert-cache.o    : convert-cache.c    autoconfig.h wwwoffle.h misc.h            errors.h config.h                              version.h

uncompress-cache.o : uncompress-cache.c autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h                              version.h

http.o             : http.c             autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h sockets.h proto.h
ftp.o              : ftp.c              autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h sockets.h proto.h
finger.o           : finger.c           autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h sockets.h proto.h
ssl.o              : ssl.c              autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h sockets.h proto.h

document.o         : document.c         autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h           proto.h document.h
html.o             : html.c             autoconfig.h wwwoffle.h misc.h            errors.h config.h                   document.h
vrml.o             : vrml.c             autoconfig.h wwwoffle.h misc.h            errors.h                            document.h
xml.o              : xml.c              autoconfig.h wwwoffle.h misc.h            errors.h                            document.h
javaclass.o        : javaclass.c        autoconfig.h wwwoffle.h misc.h            errors.h                            document.h
gifmodify.o        : gifmodify.c        autoconfig.h wwwoffle.h misc.h            errors.h                            document.h
htmlmodify.o       : htmlmodify.c       autoconfig.h wwwoffle.h misc.h                     config.h                   document.h

configdata.o       : configdata.c       autoconfig.h wwwoffle.h misc.h            errors.h config.h sockets.h                              configpriv.h
configedit.o       : configedit.c       autoconfig.h wwwoffle.h misc.h            errors.h config.h                                        configpriv.h
configfunc.o       : configfunc.c       autoconfig.h wwwoffle.h misc.h            errors.h config.h sockets.h proto.h                      configpriv.h
configmisc.o       : configmisc.c       autoconfig.h wwwoffle.h misc.h            errors.h                                                 configpriv.h
configrdwr.o       : configrdwr.c       autoconfig.h wwwoffle.h misc.h            errors.h                                                 configpriv.h

connect.o          : connect.c          autoconfig.h wwwoffle.h misc.h            errors.h config.h sockets.h                    version.h
control.o          : control.c          autoconfig.h wwwoffle.h misc.h            errors.h config.h sockets.h
controledit.o      : controledit.c      autoconfig.h wwwoffle.h misc.h            errors.h config.h
search.o           : search.c           autoconfig.h wwwoffle.h misc.h            errors.h config.h           proto.h
index.o            : index.c            autoconfig.h wwwoffle.h misc.h            errors.h config.h           proto.h
info.o             : info.c             autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h           proto.h document.h
monitor.o          : monitor.c          autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h
refresh.o          : refresh.c          autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h sockets.h         document.h

messages.o         : messages.c         autoconfig.h wwwoffle.h misc.h            errors.h config.h                              version.h
local.o            : local.c            autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h                              version.h
cgi.o              : cgi.c              autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h                              version.h

parse.o            : parse.c            autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h           proto.h
purge.o            : purge.c            autoconfig.h wwwoffle.h misc.h headbody.h errors.h config.h           proto.h
spool.o            : spool.c            autoconfig.h wwwoffle.h misc.h            errors.h config.h

errors.o           : errors.c           autoconfig.h            misc.h            errors.h config.h
io.o               : io.c               autoconfig.h wwwoffle.h misc.h            errors.h
miscencdec.o       : miscencdec.c       autoconfig.h            misc.h                                                                                  md5.h
miscurl.o          : miscurl.c          autoconfig.h            misc.h                     config.h           proto.h
headbody.o         : headbody.c         autoconfig.h            misc.h headbody.h
proto.o            : proto.c            autoconfig.h            misc.h                                        proto.h

sockets.o          : sockets.c          autoconfig.h                   errors.h          sockets.h \
                     sockets4.c sockets6.c

md5.o              : md5.c                                                                                                      md5.h

######## SOURCE FILES ########

html.c : html.l
	$(LEX) $(LEXFLAGS)  -Phtml_yy html.l
	@mv lex.html_yy.c html.c

htmlmodify.c : htmlmodify.l
	$(LEX) $(LEXFLAGS)  -Phtmlmodify_yy htmlmodify.l
	@mv lex.htmlmodify_yy.c htmlmodify.c

xml.c : xml.l
	$(LEX) $(LEXFLAGS)  -Pxml_yy xml.l
	@mv lex.xml_yy.c xml.c

vrml.c : vrml.l
	$(LEX) $(LEXFLAGS)  -Pvrml_yy vrml.l
	@mv lex.vrml_yy.c vrml.c

messages.c : messages.l
	$(LEX) $(LEXFLAGS)  -Pmsg_yy messages.l
	@mv lex.msg_yy.c messages.c

ifneq ($(PERL),)
miscencdec.c : miscencdec.c.pre
	@rm -f miscencdec.c
	$(PERL) make_bitvector.pl miscencdec.c.pre > miscencdec.c
endif

########
